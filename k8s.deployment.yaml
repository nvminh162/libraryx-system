apiVersion: apps/v1
kind: Deployment
metadata:
    name: discover-server
    labels:
        app: discover-server
spec:
    replicas: 3
    selector:
        matchLabels:
            app: discover-server
    template:
        metadata:
            labels:
                app: discover-server
        spec:
            containers:
                - name: discover-server
                  image: library-management-system-discover-server:latest
                  imagePullPolicy: IfNotPresent
                  ports:
                      - containerPort: 8761
---
apiVersion: apps/v1
kind: Deployment
metadata:
    name: api-gateway
    labels:
        app: api-gateway
spec:
    replicas: 2
    selector:
        matchLabels:
            app: api-gateway
    template:
        metadata:
            labels:
                app: api-gateway
        spec:
            containers:
                - name: api-gateway
                  image: library-management-system-api-gateway:latest
                  imagePullPolicy: IfNotPresent
                  ports:
                      - containerPort: 8080
# ===================================================
---
apiVersion: v1
kind: Service
metadata:
    name: discover-server
spec:
    selector:
        app: discover-server # match label
    ports:
        - protocol: TCP
          port: 8761
          targetPort: 8761
    type: NodePort
---
apiVersion: v1
kind: Service
metadata:
    name: api-gateway
spec:
    selector:
        app: api-gateway # match label
    ports:
        - protocol: TCP
          port: 80
          targetPort: 8080
    type: NodePort

# ===================================================
# & minikube -p minikube docker-env --shell powershell | Invoke-Expression
# docker info (Name: minikube)
# docker ps
# ===================================================
# kubectl apply -f k8s.deployment.yaml
# kubectl get pods
# kubectl logs <pod-name>

# kubectl get svc
# minikube service discover-server
# ===================================================
# kubectl delete -f k8s.deployment.yaml
# ===================================================
