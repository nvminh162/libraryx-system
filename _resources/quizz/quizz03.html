<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz</title>
  <style>
    * {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,
        "Open Sans", "Helvetica Neue", sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-size: 16px;
    }

    main {
      padding-top: 48px;
    }

    :root {
      --large-device-width: 850px;
      --primary-color: #0f172a;
      --secondary-color: #020617;
      --primary-text-color: #c7d1dd;
      --secondary-text-color: #061602;
      --success-background: hsl(159, 82%, 24%);
      --success-foreground: hsl(164, 86%, 16%);
      --success: hsl(160, 84%, 39%);
      --danger: #ef4444;
      --warning: #f59e0b;
      --info-background: hsl(218, 81%, 8%);
      --info-foreground: hsl(217, 91%, 85%);
      --border-color: #d1d7dc;
      --check-box-size: 20px;
      /* control the size */
      --check-box-color: var(--info-foreground);
      /* the active color */
    }

    body {
      position: relative;
      background-color: #020617;
      color: var(--primary-text-color);
    }

    #score-stats-container {
      position: fixed;
      z-index: 10;
      top: 0;
      height: 40px;
      width: 100%;
      background-color: var(--info-background);

      padding: 0px 16px;
      color: var(--info-foreground);
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #quiz-container {
      border-radius: 8px;
      display: flex;
      gap: 16px;
      flex-direction: column;
    }

    /* === Base Styles for both Radio and Checkbox === */
    input[type="radio"],
    input[type="checkbox"] {
        height: var(--check-box-size);
        aspect-ratio: 1;
        border: calc(var(--check-box-size) / 8) solid #939393;
        padding: calc(var(--check-box-size) / 8);
        background: radial-gradient(farthest-side, var(--check-box-color) 94%, #0000) 50%/0 0 no-repeat content-box;
        outline-offset: calc(var(--check-box-size) / 10);
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        cursor: pointer;
        font-size: inherit;
        transition: 0.3s;
    }

    input[type="radio"]:checked,
    input[type="checkbox"]:checked {
        border-color: var(--check-box-color);
        background-size: 100% 100%;
    }

    input[type="radio"]:disabled,
    input[type="checkbox"]:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* === Specific Styles === */
    input[type="radio"] {
      border-radius: 50%; /* Makes it a circle */
    }
    
    input[type="checkbox"] {
        border-radius: 4px; /* Makes it a square */
    }
    
    label {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 4px 6px;
      border-radius: 4px;
    }

    @media (max-width: 767px) {

      input[type="radio"],
      input[type="checkbox"],
      label {
        cursor: default;
      }

      #quiz-container {
        margin-left: 8px;
        margin-right: 8px;
      }
    }

    /* PC (Desktop devices) */
    @media (min-width: 768px) {
      body {
        display: flex;
        justify-content: center;
      }

      main {
        max-width: var(--large-device-width);
      }

      #score-stats-container {
        max-width: var(--large-device-width);
      }

      dialog {
        max-width: var(--large-device-width);
      }
    }

    @media print {
        input[type="radio"],
        input[type="checkbox"] {
            background: none !important;
            border-color: #939393 !important;
        }

        input[type="radio"]:checked,
        input[type="checkbox"]:checked {
            border-color: #939393 !important;
        }
    }

    .question-lable {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    button {
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      outline: none;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .button {
      background-color: var(--success-background);
      border: none;
      color: #f4f5f7;
      opacity: 0.8;
      font-size: 18px;
      flex-grow: 1;
      padding: 8px 16px;
      border-radius: 8px;
    }

    .button:hover {
      opacity: 1;
    }

    .button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .explanation-btn {
      border: none;
      color: var(--success);
      background-color: transparent;
    }

    .single-question-container {
      background-color: var(--primary-color);
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 16px;
      border-radius: 8px;
    }

    #modal-content {
      padding: 16px;
      line-height: 24px;
    }

    dialog::backdrop {
      background: rgba(0, 0, 0, 0.5);
    }

    dialog {
      position: fixed;
      border: 1px solid var(--border-color);
      background-color: var(--primary-color);
      color: rgb(240, 241, 248);
      padding: 16px;
      border-radius: 8px;
      width: 80vw;
      max-height: 80vh;
      overflow: auto;
      top: 50%;
      left: 50%;
      transform: translateX(-50%) translateY(-50%);
    }

    #close-modal-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      padding: 2px 8px;
      border-radius: 2px;
      border: none;
      background-color: var(--danger);
    }

    .correct-answer > label {
      border: 2px solid var(--success);
      width: 100%;
    }

    .incorrect-answer > label {
      border: 2px solid var(--danger);
      width: 100%;
    }

    .options-container {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    #quiz-meta-container {
      border-radius: 8px;
      background-color: var(--primary-color);
      margin-bottom: 12px;
      padding: 8px;
    }

    #quiz-title {
      text-align: center;
      font-size: 24px;
      margin-bottom: 8px;
    }

    #quiz-description {
      line-height: 1.5;
      padding: 2px 6px;
    }
  </style>
</head>

<body onload="main()">
  <main>
    <section id="quiz-meta-container">
      <h1 id="quiz-title"></h1>
      <p id="quiz-description"></p>
    </section>
    <section id="score-stats-container">
      <div id="score-card">
        Score: <span id="current-score">999</span> of
        <span id="pass-percent">999%</span>
      </div>
      <div>Correct: <span id="correct-answers">999</span></div>
      <div>Incorrect: <span id="wrong-answers">999</span></div>
    </section>

    <section id="quiz-container"></section>

    <dialog id="modal" class="modal-container">
      <div id="modal-content">
        <p id="modal-text"></p>
      </div>
    </dialog>
  </main>

  <script>
    const quizData = {"pass_percent": null, "questions": [{"_class": "assessment", "id": 60841314, "assessment_type": "multiple-choice", "prompt": {"question": "<p>API Gateway l\u00e0 g\u00ec trong ki\u1ebfn tr\u00fac ph\u1ea7n m\u1ec1m?</p>", "relatedLectureIds": ["37834602"], "feedbacks": ["", "", "API Gateway l\u00e0 m\u1ed9t c\u1ed5ng v\u00e0o duy nh\u1ea5t cho c\u00e1c y\u00eau c\u1ea7u c\u1ee7a ng\u01b0\u1eddi d\u00f9ng \u0111\u1ed1i v\u1edbi h\u1ec7 th\u1ed1ng. N\u00f3 ho\u1ea1t \u0111\u1ed9ng nh\u01b0 m\u1ed9t l\u1edbp trung gian gi\u1eefa ng\u01b0\u1eddi d\u00f9ng v\u00e0 c\u00e1c d\u1ecbch v\u1ee5 trong h\u1ec7 th\u1ed1ng ph\u00e2n t\u00e1n, \u0111i\u1ec1u h\u01b0\u1edbng y\u00eau c\u1ea7u \u0111\u1ebfn d\u1ecbch v\u1ee5 th\u00edch h\u1ee3p v\u00e0 th\u1ef1c hi\u1ec7n c\u00e1c ch\u1ee9c n\u0103ng nh\u01b0 b\u1ea3o m\u1eadt, qu\u1ea3n l\u00fd giao di\u1ec7n, ghi l\u1ea1i l\u1ecbch s\u1eed y\u00eau c\u1ea7u, v\u00e0 nhi\u1ec1u h\u01a1n n\u1eefa."], "answers": ["<p>L\u00e0 m\u1ed9t c\u01a1 ch\u1ebf \u0111\u1ec3 k\u1ebft n\u1ed1i c\u00e1c d\u1ecbch v\u1ee5 kh\u00e1c nhau trong m\u1ed9t h\u1ec7 th\u1ed1ng ph\u00e2n t\u00e1n.</p>", "<p>L\u00e0 m\u1ed9t c\u00f4ng ngh\u1ec7 \u0111\u1ec3 qu\u1ea3n l\u00fd v\u00e0 gi\u00e1m s\u00e1t c\u00e1c API trong m\u1ed9t h\u1ec7 th\u1ed1ng.</p>", "<p>L\u00e0 m\u1ed9t c\u1ed5ng v\u00e0o duy nh\u1ea5t cho c\u00e1c y\u00eau c\u1ea7u c\u1ee7a ng\u01b0\u1eddi d\u00f9ng \u0111\u1ed1i v\u1edbi h\u1ec7 th\u1ed1ng.</p>"]}, "correct_response": ["c"], "section": "", "question_plain": "API Gateway l\u00e0 g\u00ec trong ki\u1ebfn tr\u00fac ph\u1ea7n m\u1ec1m?", "related_lectures": []}, {"_class": "assessment", "id": 60841316, "assessment_type": "multiple-choice", "prompt": {"question": "<p>Spring Cloud Gateway l\u00e0 g\u00ec?</p>", "relatedLectureIds": ["37834602"], "feedbacks": ["Spring Cloud Gateway l\u00e0 m\u1ed9t th\u01b0 vi\u1ec7n m\u00e3 ngu\u1ed3n m\u1edf d\u00f9ng \u0111\u1ec3 x\u00e2y d\u1ef1ng \u1ee9ng d\u1ee5ng s\u1eed d\u1ee5ng API Gateway. N\u00f3 cung c\u1ea5p c\u00e1c c\u00f4ng c\u1ee5 v\u00e0 khung c\u00f4ng vi\u1ec7c cho vi\u1ec7c x\u00e2y d\u1ef1ng, c\u1ea5u h\u00ecnh v\u00e0 qu\u1ea3n l\u00fd m\u1ed9t c\u1ed5ng API \u0111a nhi\u1ec7m trong m\u00f4i tr\u01b0\u1eddng ph\u00e2n t\u00e1n.", "", ""], "answers": ["<p>L\u00e0 m\u1ed9t th\u01b0 vi\u1ec7n m\u00e3 ngu\u1ed3n m\u1edf cho ph\u00e1t tri\u1ec3n \u1ee9ng d\u1ee5ng s\u1eed d\u1ee5ng API Gateway.</p>", "<p>L\u00e0 m\u1ed9t d\u1ecbch v\u1ee5 cloud cung c\u1ea5p c\u00e1c ch\u1ee9c n\u0103ng API Gateway.</p>", "<p>L\u00e0 m\u1ed9t c\u00f4ng ngh\u1ec7 ph\u00e1t tri\u1ec3n b\u1edfi Google cho vi\u1ec7c x\u00e2y d\u1ef1ng c\u00e1c \u1ee9ng d\u1ee5ng web.</p>"]}, "correct_response": ["a"], "section": "", "question_plain": "Spring Cloud Gateway l\u00e0 g\u00ec?", "related_lectures": []}, {"_class": "assessment", "id": 60841320, "assessment_type": "multiple-choice", "prompt": {"question": "<p>Trong Spring Cloud Gateway, Route l\u00e0 g\u00ec?</p>", "relatedLectureIds": ["37834602"], "feedbacks": ["", "Trong Spring Cloud Gateway, Route l\u00e0 m\u1ed9t quy t\u1eafc \u0111\u1ecbnh ngh\u0129a c\u00e1ch x\u1eed l\u00fd y\u00eau c\u1ea7u t\u1eeb m\u1ed9t URL c\u1ee5 th\u1ec3. N\u00f3 x\u00e1c \u0111\u1ecbnh c\u00e1c \u0111i\u1ec1u ki\u1ec7n v\u00e0 h\u00e0nh \u0111\u1ed9ng c\u1ea7n thi\u1ebft \u0111\u1ec3 \u0111\u1ecbnh tuy\u1ebfn y\u00eau c\u1ea7u t\u1eeb URL \u0111\u01b0\u1ee3c ch\u1ec9 \u0111\u1ecbnh \u0111\u1ebfn d\u1ecbch v\u1ee5 t\u01b0\u01a1ng \u1ee9ng.", ""], "answers": ["<p>L\u00e0 m\u1ed9t URL \u0111\u1ea1i di\u1ec7n cho m\u1ed9t d\u1ecbch v\u1ee5 c\u1ee5 th\u1ec3 trong h\u1ec7 th\u1ed1ng.</p>", "<p>L\u00e0 m\u1ed9t quy t\u1eafc \u0111\u1ecbnh ngh\u0129a c\u00e1ch x\u1eed l\u00fd y\u00eau c\u1ea7u t\u1eeb m\u1ed9t URL c\u1ee5 th\u1ec3.</p>", "<p>L\u00e0 m\u1ed9t ph\u01b0\u01a1ng th\u1ee9c HTTP \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng \u0111\u1ec3 g\u1eedi y\u00eau c\u1ea7u t\u1edbi API Gateway.</p>"]}, "correct_response": ["b"], "section": "", "question_plain": "Trong Spring Cloud Gateway, Route l\u00e0 g\u00ec?", "related_lectures": []}, {"_class": "assessment", "id": 60841324, "assessment_type": "multiple-choice", "prompt": {"question": "<p>Filter l\u00e0 g\u00ec trong Spring Cloud Gateway?</p>", "relatedLectureIds": ["37834602"], "feedbacks": ["", "Filter trong Spring Cloud Gateway l\u00e0 m\u1ed9t t\u00e1c nh\u00e2n x\u1eed l\u00fd y\u00eau c\u1ea7u v\u00e0 ph\u1ea3n h\u1ed3i, cho ph\u00e9p thay \u0111\u1ed5i v\u00e0 ki\u1ec3m so\u00e1t lu\u1ed3ng d\u1eef li\u1ec7u khi \u0111i qua Gateway. C\u00e1c Filter c\u00f3 th\u1ec3 th\u1ef1c hi\u1ec7n c\u00e1c ch\u1ee9c n\u0103ng nh\u01b0 x\u00e1c th\u1ef1c, ghi log, chuy\u1ec3n \u0111\u1ed5i \u0111\u1ecbnh d\u1ea1ng d\u1eef li\u1ec7u, \u0111\u1ecbnh tuy\u1ebfn, b\u1ea3o m\u1eadt v\u00e0 nhi\u1ec1u h\u01a1n n\u1eefa.", ""], "answers": ["<p>L\u00e0 m\u1ed9t th\u00e0nh ph\u1ea7n \u0111\u1ec3 x\u00e1c th\u1ef1c ng\u01b0\u1eddi d\u00f9ng khi truy c\u1eadp v\u00e0o c\u00e1c API.</p>", "<p>L\u00e0 m\u1ed9t t\u00e1c nh\u00e2n x\u1eed l\u00fd y\u00eau c\u1ea7u v\u00e0 ph\u1ea3n h\u1ed3i, cho ph\u00e9p thay \u0111\u1ed5i v\u00e0 ki\u1ec3m so\u00e1t lu\u1ed3ng d\u1eef li\u1ec7u qua Gateway.</p>", "<p>L\u00e0 m\u1ed9t URL \u0111\u01b0\u1ee3c g\u1eedi \u0111\u1ebfn API Gateway \u0111\u1ec3 x\u00e1c \u0111\u1ecbnh \u0111i\u1ec3m cu\u1ed1i d\u1ecbch v\u1ee5 c\u1ea7n truy c\u1eadp.</p>"]}, "correct_response": ["b"], "section": "", "question_plain": "Filter l\u00e0 g\u00ec trong Spring Cloud Gateway?", "related_lectures": []}, {"_class": "assessment", "id": 60841328, "assessment_type": "multiple-choice", "prompt": {"question": "<p>Spring Cloud Gateway h\u1ed7 tr\u1ee3 kh\u1ea3 n\u0103ng c\u00e2n b\u1eb1ng t\u1ea3i gi\u1eefa c\u00e1c phi\u00ean b\u1ea3n d\u1ecbch v\u1ee5 kh\u00e1c nhau kh\u00f4ng?</p>", "relatedLectureIds": ["37834602"], "feedbacks": ["Spring Cloud Gateway h\u1ed7 tr\u1ee3 kh\u1ea3 n\u0103ng c\u00e2n b\u1eb1ng t\u1ea3i gi\u1eefa c\u00e1c phi\u00ean b\u1ea3n d\u1ecbch v\u1ee5 kh\u00e1c nhau. N\u00f3 c\u00f3 th\u1ec3 t\u1ef1 \u0111\u1ed9ng ph\u00e2n ph\u1ed1i l\u01b0u l\u01b0\u1ee3ng y\u00eau c\u1ea7u \u0111\u1ebfn c\u00e1c phi\u00ean b\u1ea3n d\u1ecbch v\u1ee5 kh\u00e1c nhau \u0111\u1ec3 c\u00e2n b\u1eb1ng t\u1ea3i v\u00e0 \u0111\u1ea3m b\u1ea3o r\u1eb1ng c\u00e1c d\u1ecbch v\u1ee5 ho\u1ea1t \u0111\u1ed9ng hi\u1ec7u qu\u1ea3 v\u00e0 s\u1eb5n s\u00e0ng ph\u1ee5c v\u1ee5 ng\u01b0\u1eddi d\u00f9ng.", ""], "answers": ["<p>C\u00f3, Spring Cloud Gateway c\u00f3 kh\u1ea3 n\u0103ng c\u00e2n b\u1eb1ng t\u1ea3i gi\u1eefa c\u00e1c phi\u00ean b\u1ea3n d\u1ecbch v\u1ee5 \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o hi\u1ec7u su\u1ea5t v\u00e0 s\u1eb5n s\u00e0ng cao.</p>", "<p>Kh\u00f4ng, Spring Cloud Gateway kh\u00f4ng h\u1ed7 tr\u1ee3 c\u00e2n b\u1eb1ng t\u1ea3i, nhi\u1ec7m v\u1ee5 n\u00e0y \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n b\u1edfi c\u00e1c c\u00f4ng c\u1ee5 kh\u00e1c trong m\u1ea1ng.</p>"]}, "correct_response": ["a"], "section": "", "question_plain": "Spring Cloud Gateway h\u1ed7 tr\u1ee3 kh\u1ea3 n\u0103ng c\u00e2n b\u1eb1ng t\u1ea3i gi\u1eefa c\u00e1c phi\u00ean b\u1ea3n d\u1ecbch v\u1ee5 kh\u00e1c nhau kh\u00f4ng?", "related_lectures": []}]};

     let correct = new Set();
    let incorrect = new Set();
    let totalNumberOfQuestions = 0;
    const quizTitle = quizData.quiz_title || "Quiz";
    const quizDescription = quizData.quiz_description || "Please answer the questions below.";
    const questionData = quizData.questions;
    const passPercent = quizData.pass_percent;
    const modalTextElement = document.getElementById("modal-text");
    const quizContainerElement = document.getElementById("quiz-container");
    const dialog = document.querySelector("dialog");
    const closeButton = document.getElementById("close-modal-btn");
    const quizTitleElement = document.getElementById("quiz-title");
    const quizDescriptionElement = document.getElementById("quiz-description");

    function main() {
      // update quiz meta data
      document.title = quizTitle;
      quizTitleElement.innerHTML = quizTitle;
      quizDescriptionElement.innerHTML = quizDescription;

      const passPercentElement = document.getElementById("pass-percent");
      passPercentElement.innerHTML = passPercent ? `${passPercent}%` : "N/A";
      totalNumberOfQuestions = questionData.length;
      
      if(closeButton) {
          closeButton.addEventListener("click", () => dialog.close());
      }

      // shuffle the questionData to randomize the order
      for (let i = questionData.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [questionData[i], questionData[j]] = [questionData[j], questionData[i]];
      }

      let formattedQuestions = questionData.map(formatSingleQuestionData);
      updateScore();
      // display the formattedQuestions
      formattedQuestions.forEach((question, idx) => {
        renderSingleQuestion(question, idx + 1);
      });
    }

    /**
     * Formats the raw question data into a more usable structure.
     */
    function formatSingleQuestionData(singleQuizData = null) {
        const { prompt, correct_response, id, assessment_type } = singleQuizData;
        
        const answers = prompt.answers || [];
        // Create a detailed answer object including correctness
        const formattedAnswers = answers.map((answerText, index) => {
            const letter = String.fromCharCode(97 + index); // a, b, c...
            const isCorrect = correct_response.includes(letter);
            return {
                text: answerText,
                isCorrect: isCorrect
            };
        });

        return {
            id: id,
            assessment_type: assessment_type,
            question: prompt.question,
            answers: formattedAnswers, // Use the new formatted answers
            explanation: prompt?.explanation || "",
            feedbacks: prompt.feedbacks
        };
    }

    /**
     * Renders a single question.
     */
    const renderSingleQuestion = (singleQuestionData = {}, rootIndex = 1) => {
        const { id, explanation, answers, question, feedbacks, assessment_type } = singleQuestionData;

        // shuffle the answers to randomize their order
        // for (let i = answers.length - 1; i > 0; i--) {
        //     const j = Math.floor(Math.random() * (i + 1));
        //     [answers[i], answers[j]] = [answers[j], answers[i]];
        // }
        
        const inputType = assessment_type === 'multi-select' ? 'checkbox' : 'radio';
        const inputName = `answer_${id}`; // Unique name for each question group

        const optionsHTML = answers
            .map((option, index) => {
                const optionId = `${id}_${index}`;
                return `
                <div class="question-lable">
                    <input type="${inputType}" id="${optionId}" name="${inputName}" value="${option.text}" data-is-correct="${option.isCorrect}" />
                    <label for="${optionId}">${option.text}</label>
                </div>
                `;
            })
            .join("");

        const container = document.createElement("div");
        container.innerHTML = `
            <form data-question-id="${id}" class="single-question-container" onsubmit="submitButtonListener(event)">
                <div style="display: flex;justify-content: space-between;">
                    <p style="font-weight: 600">Question ${rootIndex}:</p>
                    <button type="button" onclick="renderExplanation(event)" data-feedbacks='${JSON.stringify(feedbacks)}' data-explanation="${explanation}" class="explanation-btn">View Explanation</button>
                </div>
                <p style="margin-bottom: 8px;line-height: 1.5">${question}</p>
                <div class="options-container">
                    ${optionsHTML}
                </div>
                <div style="display: flex; gap: 8px;">
                    <button type="submit" class="button submit-btn">Submit</button>
                </div>
            </form>
        `;
        quizContainerElement.appendChild(container);
    };

    /**
     * Updates the score board.
     */
    function updateScore() {
        const currentPercentageElement = document.getElementById("current-score");
        const correctAnswerElement = document.getElementById("correct-answers");
        const wrongAnswerElement = document.getElementById("wrong-answers");
        correctAnswerElement.innerHTML = correct.size;
        wrongAnswerElement.innerHTML = incorrect.size;
        if (totalNumberOfQuestions > 0) {
            const score = Number((correct.size / totalNumberOfQuestions) * 100).toFixed(0);
            currentPercentageElement.innerHTML = score;
        }
    }

    /**
    * Compares two sets for equality.
    */
    function setsAreEqual(setA, setB) {
        if (setA.size !== setB.size) {
            return false;
        }
        for (const item of setA) {
            if (!setB.has(item)) {
            return false;
            }
        }
        return true;
    }


    /**
     * Handles the form submission for a single question.
     */
    const submitButtonListener = (e) => {
        e.preventDefault();
        const form = e.target;
        const questionId = form.dataset.questionId;
        const inputs = form.querySelectorAll('input[type="radio"], input[type="checkbox"]');
        
        const userSelectedValues = new Set();
        const actualCorrectValues = new Set();
        let hasSelection = false;

        inputs.forEach(input => {
            if (input.checked) {
                userSelectedValues.add(input.value);
                hasSelection = true;
            }
            if (input.dataset.isCorrect === 'true') {
                actualCorrectValues.add(input.value);
            }
        });

        if (!hasSelection) {
            alert("Please select an answer!");
            return;
        }

        const isFullyCorrect = setsAreEqual(userSelectedValues, actualCorrectValues);

        if (isFullyCorrect) {
            correct.add(questionId);
            incorrect.delete(questionId);
        } else {
            incorrect.add(questionId);
            correct.delete(questionId);
        }
        
        updateScore();

        // Apply visual feedback and disable the form
        form.querySelectorAll(".question-lable").forEach(labelContainer => {
            const input = labelContainer.querySelector('input');
            labelContainer.classList.remove("correct-answer", "incorrect-answer");

            // Highlight all correct answers
            if (input.dataset.isCorrect === 'true') {
                labelContainer.classList.add("correct-answer");
            } 
            // Highlight user's incorrect selections
            else if (input.checked && input.dataset.isCorrect === 'false') {
                labelContainer.classList.add("incorrect-answer");
            }
        });

      
    };

    /**
     * Renders the explanation in a modal dialog.
     */
    function renderExplanation(ev) {
        modalTextElement.innerHTML = '';
        const explanation = ev.target.dataset?.explanation;
        const feedbacksString = ev.target.dataset?.feedbacks;
        let contentFound = false;

        if (explanation && explanation.trim() !== "") {
            modalTextElement.innerHTML += explanation;
            contentFound = true;
        }

        if (feedbacksString) {
            try {
                const feedbacks = JSON.parse(feedbacksString);
                feedbacks.forEach(feedback => {
                    if (feedback && feedback.trim() !== "") {
                        modalTextElement.innerHTML += feedback;
                        contentFound = true;
                    }
                });
            } catch (e) {
                console.error("Error parsing feedbacks JSON:", e);
            }
        }

        if (!contentFound) {
            modalTextElement.innerHTML = "<p>No explanation found for this question.</p>";
        }

        dialog.showModal();
        dialog.addEventListener("click", (event) => {
            if (event.target === dialog) {
                dialog.close();
            }
        });
    }
  </script>
</body>

</html>